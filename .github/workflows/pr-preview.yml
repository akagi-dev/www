name: PR Preview

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  build-preview:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build website
        run: npm run build
      
      - name: Upload preview artifact
        uses: actions/upload-artifact@v4
        with:
          name: pr-preview-${{ github.event.pull_request.number }}
          path: ./dist
          retention-days: 7
      
      - name: Comment PR
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.issue.number;
            const message = `âœ… Preview build completed successfully!
            
            **Build artifact:** \`pr-preview-${prNumber}\`
            
            To test locally:
            1. Download the artifact from the Actions tab
            2. Extract and serve the \`dist\` folder
            3. Navigate to \`http://localhost:<port>/www\`
            
            **Languages available:**
            - English: \`/www/en/\`
            - Japanese: \`/www/ja/\`
            - Russian: \`/www/ru/\``;
            
            github.rest.issues.createComment({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });
