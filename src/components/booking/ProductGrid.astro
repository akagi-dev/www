---
/**
 * Product Grid Component
 * Displays a grid of product cards with selection functionality
 * 
 * Supports two modes:
 * 1. Legacy mode: productType='car' or 'track' (backward compatible)
 * 2. Collection mode: collectionHandle='drift-cars' (new universal approach)
 */

export interface Props {
  id: string;
  label: string;
  required?: boolean;
  locale?: string;
  /** @deprecated Use collectionHandle instead */
  productType?: 'car' | 'track';
  /** Collection handle for fetching products (e.g., 'drift-cars', 'drift-tracks') */
  collectionHandle?: string;
}

const { id, label, required = false, locale = 'en', productType, collectionHandle } = Astro.props;

// Map legacy productType to collection handles for backward compatibility
const collectionMap: Record<string, string> = {
  'car': 'drift-cars',
  'track': 'drift-tracks'
};

// Determine which collection to use
const finalCollectionHandle = collectionHandle || (productType ? collectionMap[productType] : undefined);
---

<div class="product-grid-container">
  <label class="block text-sm font-medium text-gray-700 mb-2">
    {label} {required && <span class="text-akagi-red">*</span>}
  </label>
  
  <div 
    id={`${id}-loading`}
    class="flex items-center justify-center py-8 text-gray-500"
  >
    <svg class="animate-spin h-8 w-8 mr-3" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    Loading products...
  </div>
  
  <div
    id={id}
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 hidden"
    data-product-type={productType}
    data-collection-handle={finalCollectionHandle}
    data-locale={locale}
  >
  </div>
  
  <div
    id={`${id}-error`}
    class="hidden bg-red-50 border border-red-200 rounded-md p-4 text-red-800"
  >
    <p class="font-semibold">Failed to load products</p>
    <p class="text-sm">Using fallback data. Please check your Shopify configuration.</p>
  </div>
  
  <input type="hidden" id={`${id}-value`} name={id} required={required} />
</div>

<style>
  @media (max-width: 640px) {
    .product-grid-container {
      margin-bottom: 1.5rem;
    }
  }
</style>
